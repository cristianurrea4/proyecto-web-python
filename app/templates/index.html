{% extends "base.html" %}

{% block title %}{{ section_title }}{% endblock %}

{% block content %}

<div class="main-container">
    {% if section_title == "Home" %}
    {% if media_viewed_list|length > 0 %}
    <div id="viewedCarousel" class="carousel slide" data-bs-ride="false">
        <h2>Visto Recientemente</h2>
        <div class="carousel-inner">
            {% for i in range(0, media_viewed_list|length, carousel_size) %}
            <div class="carousel-item {% if i == 0 %}active{% endif %}">
                <div class="catalog-grid">
                    {% for media in media_viewed_list[i:i + carousel_size] %}
                    <div class="card">
                        <div class="card-img-top">
                            {% if media.image_url %}
                            <img src="{{ media.image_url }}" alt="{{ media.title }}">
                            {% endif %}
                            <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                                    <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                                    <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                                    <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                                </button>
                            </form>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#viewedCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#viewedCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    {% endif %}

    {% if recent_media|length > 0 %}
    <div id="mediaCarousel" class="carousel slide" data-bs-ride="carousel">
        <h2>Recientemente Añadido</h2>
        <div class="carousel-inner">
            {% for i in range(0, recent_media|length, carousel_size) %}
            <div class="carousel-item {% if i == 0 %}active{% endif %}">
                <div class="catalog-grid">
                    {% for media in recent_media[i:i + carousel_size] %}
                    <div class="card">
                        <div class="card-img-top">
                            {% if media.image_url %}
                            <img src="{{ media.image_url }}" alt="{{ media.title }}">
                            {% endif %}
                            <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                                    <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                                    <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                                    <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                                </button>
                            </form>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#mediaCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#mediaCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    {% endif %}

    {% if popular_media|length > 0 %}
    <div id="popularCarousel" class="carousel slide" data-bs-ride="false">
        <h2>Más Populares</h2>
        <div class="carousel-inner">
            {% set global_index = 1 %}
            {% for i in range(0, popular_media|length, carousel_size) %}
            <div class="carousel-item {% if i == 0 %}active{% endif %}">
                <div class="catalog-grid">
                    {% for media in popular_media[i:i + carousel_size] %}
                    <div class="card">
                        <!-- Mostrar el número global -->
                        <div class="card-rank">
                            {% if global_index <= 10 %}
                            {{ global_index }}
                            {% endif %}
                        </div>
                        <div class="card-img-top">
                            {% if media.image_url %}
                            <img src="{{ media.image_url }}" alt="{{ media.title }}">
                            {% endif %}
                            <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                                    <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                                    <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                                    <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                                </button>
                            </form>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
                    </div>
                    {% set global_index = global_index + 1 %}
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#popularCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#popularCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    {% endif %}

    {% if movies|length > 0 %}
    <div id="moviesCarousel" class="carousel slide" data-bs-ride="false">
        <h2>Películas</h2>
        <div class="carousel-inner">
            {% for i in range(0, movies|length, carousel_size) %}
            <div class="carousel-item {% if i == 0 %}active{% endif %}">
                <div class="catalog-grid">
                    {% for media in movies[i:i + carousel_size] %}
                    <div class="card">
                        <div class="card-img-top">
                            {% if media.image_url %}
                            <img src="{{ media.image_url }}" alt="{{ media.title }}">
                            {% endif %}
                            <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                                    <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                                    <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                                    <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                                </button>
                            </form>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#moviesCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#moviesCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    {% endif %}

    {% if series|length > 0 %}
    <div id="seriesCarousel" class="carousel slide" data-bs-ride="false">
        <h2>Series</h2>
        <div class="carousel-inner">
            {% for i in range(0, series|length, carousel_size) %}
            <div class="carousel-item {% if i == 0 %}active{% endif %}">
                <div class="catalog-grid">
                    {% for media in series[i:i + carousel_size] %}
                    <div class="card">
                        <div class="card-img-top">
                            {% if media.image_url %}
                            <img src="{{ media.image_url }}" alt="{{ media.title }}">
                            {% endif %}
                            <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                                    <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                                    <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                                <input type="hidden" name="media_id" value="{{ media.id }}">
                                <button data-media-id="{{ media.id }}"
                                        class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                                    <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                                </button>
                            </form>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#seriesCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#seriesCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    {% endif %}

    {% elif section_title == "Viewed" %}
    {% if media|length > 0 %}
    <div class="catalog-filter">
        <h2>Vistos</h2>
        <div class="catalog-grid {{ 'other-page' if section_title == 'Viewed'}}">
            {% for media in media %}
            <div class="card">
                <div class="card-img-top">
                    {% if media.image_url %}
                    <img src="{{ media.image_url }}" alt="{{ media.title }}">
                    {% endif %}
                    <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                            <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                            <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                            <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                        </button>
                    </form>
                </div>
                <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% elif section_title == "Movies" %}
    {% if media|length > 0 %}
    <div class="catalog-filter">
        <h2>Películas</h2>
        <div class="catalog-grid {{ 'other-page' if section_title == 'Movies'}}">
            {% for media in media %}
            <div class="card">
                <div class="card-img-top">
                    {% if media.image_url %}
                    <img src="{{ media.image_url }}" alt="{{ media.title }}">
                    {% endif %}
                    <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                            <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                            <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                            <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                        </button>
                    </form>
                </div>
                <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% elif section_title == "Series" %}
    {% if media|length > 0 %}
    <div class="catalog-filter">
        <h2>Series</h2>
        <div class="catalog-grid {{ 'other-page' if section_title == 'Series'}}">
            {% for media in media %}
            <div class="card">
                <div class="card-img-top">
                    {% if media.image_url %}
                    <img src="{{ media.image_url }}" alt="{{ media.title }}">
                    {% endif %}
                    <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                            <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                            <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                            <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                        </button>
                    </form>
                </div>
                <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% elif section_title == "Favorites" %}
    {% if media|length > 0 %}
    <div class="catalog-filter">
        <h2>Favoritos</h2>
        <div class="catalog-grid {{ 'other-page' if section_title == 'Series'}}">
            {% for media in media %}
            <div class="card">
                <div class="card-img-top">
                    {% if media.image_url %}
                    <img src="{{ media.image_url }}" alt="{{ media.title }}">
                    {% endif %}
                    <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                            <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                            <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                            <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                        </button>
                    </form>
                </div>
                <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% elif section_title == "Search" %}
    <div class="catalog-filter">
        <h2>Resultados</h2>
        <div class="catalog-grid {{ 'other-page' if section_title == 'Search'}}">
            {% if media %}
            {% for media in media %}
            <div class="card">
                <div class="card-img-top">
                    {% if media.image_url %}
                    <img src="{{ media.image_url }}" alt="{{ media.title }}">
                    {% endif %}
                    <form action="{{ url_for('toggle_like') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-like {{ 'active' if media.id in media_likes }}">
                            <i class="bi {{ 'bi-heart-fill' if media.id in media_likes else 'bi-heart' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_favorite') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-favorite {{ 'active' if media.id in favorite_media }}">
                            <i class="bi {{ 'bi-star-fill' if media.id in favorite_media else 'bi-star' }}"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('toggle_viewed') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="media_id" value="{{ media.id }}">
                        <button data-media-id="{{ media.id }}"
                                class="btn-icon btn-icon-viewed {{ 'active' if media.id in media_viewed }}">
                            <i class="bi {{ 'bi-eye-fill' if media.id in media_viewed else 'bi-eye' }}"></i>
                        </button>
                    </form>
                </div>
                <div class="card-body">
                            <h5 class="card-title" title="{{media.title}}">{{ media.title }}</h5>
                            <p class="card-text">{{ media.description }}</p>
                            <p class="card-text">
                                {% if media.duration %}
                                <small class="text-muted">Duración: {{ format_duration(media.duration)
                                    }}</small>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                {% if media.episode_duration %}
                                <small class="text-muted">Duración por episodio: {{
                                    format_duration(media.episode_duration) }}</small>
                                <br>
                                {% if media.episodes %}
                                <small class="text-muted episodes">{{ media.episodes }} episodios</small>
                                {% endif %}
                                {% endif %}
                            </p>
                            <div class="card-categories mb-2">
                            {% if media.categories %}
                                {% for category in media.categories.split(',') %}
                                <span class="badge">{{ category.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                            </div>
                            <a href="{{ url_for('media_details', media_id=media.id) }}" class="btn btn-primary">Ver
                                Detalles</a>
                        </div>
            </div>
            {% endfor %}
            {% else %}
            <p>No se encontraron resultados para tu búsqueda.</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<script src="{{ url_for('static', filename='scripts/index.js') }}"></script>
{% endblock %}